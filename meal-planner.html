<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ú–µ–Ω—é">
    <meta name="theme-color" content="#10b981">
    <link rel="manifest" href="meal-manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçΩÔ∏è</text></svg>">
    <title>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–µ–Ω—é</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 100px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        .category {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .category h2 {
            color: #10b981;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .meal-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
            border-radius: 8px;
            margin: 0 -8px;
            padding-left: 8px;
            padding-right: 8px;
        }
        .meal-item:last-child {
            border-bottom: none;
        }
        .meal-item:active {
            background: #f0fdf4;
        }
        .meal-item input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: #10b981;
            flex-shrink: 0;
        }
        .meal-info {
            flex: 1;
        }
        .meal-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }
        .meal-ingredients {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }
        .meal-item.selected {
            background: #f0fdf4;
        }
        .meal-item.selected .meal-name {
            color: #10b981;
        }
        .shopping-list {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .shopping-list h2 {
            color: #10b981;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .shopping-list ul {
            list-style: none;
            padding: 0;
        }
        .shopping-list li {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .shopping-list li:last-child {
            border-bottom: none;
        }
        .shopping-list li input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #10b981;
        }
        .shopping-list li.checked {
            text-decoration: line-through;
            color: #999;
        }
        .empty-state {
            text-align: center;
            color: #999;
            padding: 30px;
        }
        .floating-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
        }
        .floating-btn:active {
            transform: translateX(-50%) scale(0.95);
        }
        .badge {
            background: white;
            color: #10b981;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .tab.active {
            background: #10b981;
            color: white;
        }
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }
        .copy-btn {
            background: #f0fdf4;
            color: #10b981;
            border: 2px solid #10b981;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
        }
        .copy-btn:active {
            background: #10b981;
            color: white;
        }
        .clear-btn {
            background: #fef2f2;
            color: #ef4444;
            border: 2px solid #ef4444;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        .selected-meals {
            background: #f0fdf4;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .selected-meals h3 {
            color: #10b981;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .selected-meals-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .selected-meal-tag {
            background: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #333;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 200;
        }
        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçΩÔ∏è –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–µ–Ω—é</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showView('meals')">–ë–ª—é–¥–∞</button>
            <button class="tab" onclick="showView('shopping')">–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</button>
        </div>

        <div id="mealsView" class="view active">
            <div id="categories"></div>
        </div>

        <div id="shoppingView" class="view">
            <div id="selectedMealsContainer"></div>
            <div class="shopping-list">
                <h2>üõí –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h2>
                <ul id="shoppingList"></ul>
                <button class="copy-btn" onclick="copyList()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫</button>
                <button class="clear-btn" onclick="clearSelection()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä</button>
            </div>
        </div>
    </div>

    <div id="floatingBtn" class="floating-btn" onclick="showView('shopping')" style="display: none;">
        –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ <span class="badge" id="selectedCount">0</span>
    </div>

    <div id="toast" class="toast">–°–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!</div>

    <script>
        const MEALS = {
            "–°—É–ø—ã": [
                { name: "–ë–æ—Ä—â", ingredients: ["–≥–æ–≤—è–¥–∏–Ω–∞ –Ω–∞ —Å—É–ø", "—Å–≤—ë–∫–ª–∞", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–º–æ—Ä–∫–æ–≤—å", "—Ç–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞", "—á–µ—Å–Ω–æ–∫", "—É–∫—Ä–æ–ø"] },
                { name: "–ì–æ—Ä–æ—Ö–æ–≤—ã–π —Å—É–ø", ingredients: ["–≥–æ—Ä–æ—Ö", "–≥–æ–≤—è–¥–∏–Ω–∞ –Ω–∞ —Å—É–ø", "–∫–æ–ø—á—ë–Ω–æ—Å—Ç–∏", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–º–æ—Ä–∫–æ–≤—å"] },
                { name: "–ö—É—Ä–∏–Ω—ã–π —Å—É–ø", ingredients: ["–∫—É—Ä–∏—Ü–∞", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–º–æ—Ä–∫–æ–≤—å", "–ª—É–∫", "–ª–∞–ø—à–∞"] },
                { name: "–£—Ö–∞ –ø–æ-—Ñ–∏–Ω—Å–∫–∏", ingredients: ["—Ä—ã–±–∞", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–ª—É–∫-–ø–æ—Ä–µ–π", "–±–æ–ª–≥–∞—Ä—Å–∫–∏–π –ø–µ—Ä–µ—Ü", "–º–æ—Ä–∫–æ–≤—å", "—Å–ª–∏–≤–∫–∏", "—É–∫—Ä–æ–ø"] },
                { name: "–°—É–ø —Å —Ñ—Ä–∏–∫–∞–¥–µ–ª—å–∫–∞–º–∏", ingredients: ["—Ñ–∞—Ä—à", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–º–æ—Ä–∫–æ–≤—å", "—Ä–∏—Å"] },
                { name: "–¢—ã–∫–≤–µ–Ω–Ω—ã–π —Å—É–ø-–ø—é—Ä–µ", ingredients: ["—Ç—ã–∫–≤–∞", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–º–æ—Ä–∫–æ–≤—å", "–ª—É–∫", "—Å–ª–∏–≤–∫–∏"] },
                { name: "–°—ã—Ä–Ω—ã–π —Å—É–ø", ingredients: ["–±—É–ª—å–æ–Ω", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–º–æ—Ä–∫–æ–≤—å", "–ª—É–∫", "–ø–ª–∞–≤–ª–µ–Ω—ã–π —Å—ã—Ä", "—Å–ª–∏–≤–∫–∏"] }
            ],
            "–î—É—Ö–æ–≤–∫–∞": [
                { name: "–ú—è—Å–æ –ø–æ-—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π", ingredients: ["–º—è—Å–æ", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–ª—É–∫", "–ø–æ–º–∏–¥–æ—Ä", "—Å—ã—Ä —Ç—ë—Ä—Ç—ã–π", "–º–∞–π–æ–Ω–µ–∑"] },
                { name: "–ö—É—Ä–∏—Ü–∞ –≤ –¥—É—Ö–æ–≤–∫–µ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π", ingredients: ["–∫—É—Ä–∏—Ü–∞", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–ø–æ–º–∏–¥–æ—Ä", "—Å—ã—Ä —Ç—ë—Ä—Ç—ã–π", "–º–∞–π–æ–Ω–µ–∑"] },
                { name: "–°–∏–±–∞—Å—Å –≤ –¥—É—Ö–æ–≤–∫–µ", ingredients: ["—Å–∏–±–∞—Å—Å"] },
                { name: "–ü–µ—Ä–µ—Ü —Ñ–∞—Ä—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", ingredients: ["–±–æ–ª–≥–∞—Ä—Å–∫–∏–π –ø–µ—Ä–µ—Ü", "—Ñ–∞—Ä—à", "—Ä–∏—Å", "–ª—É–∫", "–º–æ—Ä–∫–æ–≤—å"] },
                { name: "–¢–≤–æ—Ä–æ–∂–Ω–∏–∫-–º–∞–Ω–Ω–∏–∫", ingredients: ["—Ç–≤–æ—Ä–æ–≥", "–º–∞–Ω–∫–∞", "—è–π—Ü–∞", "—Å–∞—Ö–∞—Ä", "–º–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ"] },
                { name: "–ü–∏—Ü—Ü–∞", ingredients: ["–º—É–∫–∞", "–¥—Ä–æ–∂–∂–∏", "—Ç–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å", "—Å—ã—Ä —Ç—ë—Ä—Ç—ã–π", "—Å–∞–ª—è–º–∏"] }
            ],
            "–°–∫–æ–≤–æ—Ä–æ–¥–∞": [
                { name: "–®–Ω–∏—Ü–µ–ª—å –∫—É—Ä–∏–Ω—ã–π", ingredients: ["–∫—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ", "—è–π—Ü–∞", "–º—É–∫–∞", "–ø–∞–Ω–∏—Ä–æ–≤–∫–∞"] },
                { name: "–ö–æ—Ç–ª–µ—Ç—ã", ingredients: ["—Ñ–∞—Ä—à", "–ª—É–∫", "—è–π—Ü–æ", "–±–∞—Ç–æ–Ω", "–º–æ–ª–æ–∫–æ"] },
                { name: "–î—Ä–∞–Ω–∏–∫–∏", ingredients: ["–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "—è–π—Ü–æ", "–º—É–∫–∞"] },
                { name: "–ë–µ—Ñ—Å—Ç—Ä–æ–≥–∞–Ω–æ–≤", ingredients: ["–≥–æ–≤—è–¥–∏–Ω–∞ –º—è–∫–æ—Ç—å", "–º—É–∫–∞", "—Å–º–µ—Ç–∞–Ω–∞"] },
                { name: "–ñ–∞—Ä–µ–Ω–∞—è –∫–∞—Ä—Ç–æ—à–∫–∞", ingredients: ["–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "—Å–≤–∏–Ω–∏–Ω–∞"] },
                { name: "–ö—É—Ä–∏—Ü–∞ –≤ —è–π—Ü–µ", ingredients: ["–∫—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ", "—è–π—Ü–∞"] },
                { name: "–†—ã–±–∞ –≤ —Ç–µ—Å—Ç–µ", ingredients: ["–ª–æ—Å–æ—Å—å", "–º—É–∫–∞", "—è–π—Ü–æ"] }
            ],
            "–ü–∞—Å—Ç–∞ / —Ä–∏—Å": [
                { name: "–ü–∞—Å—Ç–∞ –±–æ–ª–æ–Ω—å–µ–∑–µ", ingredients: ["—Ñ–∞—Ä—à", "–ø–∞—Å—Ç–∞", "—Ç–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å", "–ª—É–∫", "–º–æ—Ä–∫–æ–≤—å"] },
                { name: "–ü–∞—Å—Ç–∞ —Å –ª–æ—Å–æ—Å–µ–º –∏ —Å–ª–∏–≤–∫–∞–º–∏", ingredients: ["–ø–∞—Å—Ç–∞", "–ª–æ—Å–æ—Å—å", "—Å–ª–∏–≤–∫–∏", "—Å—ã—Ä —Ç—ë—Ä—Ç—ã–π"] },
                { name: "–ü–∞—Å—Ç–∞ —Å —Ñ—Ä–∏–∫–∞–¥–µ–ª—å–∫–∞–º–∏", ingredients: ["–ø–∞—Å—Ç–∞", "—Ñ–∞—Ä—à", "—Ç–æ–º–∞—Ç—ã –∏–∑–º–µ–ª—å—á–µ–Ω–Ω—ã–µ", "—á–µ—Å–Ω–æ–∫", "—Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ", "–º–æ–ª–æ–∫–æ", "–º–∞–π–æ—Ä–∞–Ω", "–º–∞–Ω–∫–∞"] },
                { name: "–ü–∞—Å—Ç–∞ —Å –∫—Ä–µ–≤–µ—Ç–∫–∞–º–∏", ingredients: ["–ø–∞—Å—Ç–∞", "–∫—Ä–µ–≤–µ—Ç–∫–∏", "—á–µ—Å–Ω–æ–∫", "—Å–ª–∏–≤–∫–∏"] },
                { name: "–ü–∞—Å—Ç–∞ —Å —Ç—É–Ω—Ü–æ–º", ingredients: ["–ø–∞—Å—Ç–∞", "—Ç—É–Ω–µ—Ü", "—Å–ª–∏–≤–∫–∏", "–ª—É–∫"] },
                { name: "–ñ–∞—Ä–µ–Ω—ã–π —Ä–∏—Å —Å –∫—Ä–µ–≤–µ—Ç–∫–∞–º–∏", ingredients: ["—Ä–∏—Å", "–∫—Ä–µ–≤–µ—Ç–∫–∏", "—è–π—Ü–æ", "—Å–æ–µ–≤—ã–π —Å–æ—É—Å", "–∫—É–∫—É—Ä—É–∑–∞", "–º–æ—Ä–∫–æ–≤—å", "–∑–µ–ª–µ–Ω—ã–π –≥–æ—Ä–æ—à–µ–∫"] },
                { name: "–ü–∞—Å—Ç–∞ —Å –∫—É—Ä–∏—Ü–µ–π –∏ –±—Ä–æ–∫–∫–æ–ª–∏", ingredients: ["–ø–∞—Å—Ç–∞", "–∫—É—Ä–∏—Ü–∞", "–±—Ä–æ–∫–∫–æ–ª–∏", "—Å–ª–∏–≤–∫–∏", "—Å—ã—Ä —Ç—ë—Ä—Ç—ã–π", "—á–µ—Å–Ω–æ–∫"] }
            ],
            "–•–æ–ª–æ–¥–Ω–æ–µ": [
                { name: "–°–æ–ª—ë–Ω—ã–π –ª–æ—Å–æ—Å—å —Å –ø—é—Ä–µ", ingredients: ["–ª–æ—Å–æ—Å—å", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–º–æ–ª–æ–∫–æ", "—Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ"] },
                { name: "–ö—Ä–∞–±–æ–≤—ã–π —Å–∞–ª–∞—Ç", ingredients: ["–∫—Ä–∞–±–æ–≤—ã–µ –ø–∞–ª–æ—á–∫–∏", "—è–π—Ü–∞", "–∫—É–∫—É—Ä—É–∑–∞", "–º–∞–π–æ–Ω–µ–∑", "–æ–≥—É—Ä—Ü—ã", "—Ä–∏—Å"] }
            ],
            "–ú–∏–Ω–∏–º—É–º —É—Å–∏–ª–∏–π": [
                { name: "–û–º–ª–µ—Ç", ingredients: ["—è–π—Ü–∞", "–º–æ–ª–æ–∫–æ"] },
                { name: "–Ø–∏—á–Ω–∏—Ü–∞", ingredients: ["—è–π—Ü–∞"] },
                { name: "–ü–µ–ª—å–º–µ–Ω–∏", ingredients: ["–ø–µ–ª—å–º–µ–Ω–∏"] },
                { name: "–í–∞—Ä–µ–Ω–∏–∫–∏", ingredients: ["–≤–∞—Ä–µ–Ω–∏–∫–∏"] },
                { name: "–¢–≤–æ—Ä–æ–≥ —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π", ingredients: ["—Ç–≤–æ—Ä–æ–≥", "—Å–º–µ—Ç–∞–Ω–∞"] },
                { name: "–ú–∞–∫–∞—Ä–æ–Ω—ã —Å —Å–æ—Å–∏—Å–∫–∞–º–∏/–Ω–∞–≥–µ—Ç—Å–∞–º–∏", ingredients: ["–º–∞–∫–∞—Ä–æ–Ω—ã", "—Å–æ—Å–∏—Å–∫–∏/–Ω–∞–≥–µ—Ç—Å—ã"] },
                { name: "–ì—Ä–µ—á–∫–∞ —Å –º–æ–ª–æ–∫–æ–º", ingredients: ["–≥—Ä–µ—á–∫–∞", "–º–æ–ª–æ–∫–æ"] }
            ]
        };

        let selectedMeals = JSON.parse(localStorage.getItem('selectedMeals') || '[]');
        let checkedItems = JSON.parse(localStorage.getItem('checkedItems') || '[]');

        function saveSelection() {
            localStorage.setItem('selectedMeals', JSON.stringify(selectedMeals));
            localStorage.setItem('checkedItems', JSON.stringify(checkedItems));
        }

        function renderCategories() {
            const container = document.getElementById('categories');
            container.innerHTML = '';

            for (const [category, meals] of Object.entries(MEALS)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                
                const icons = {
                    '–°—É–ø—ã': 'üç≤',
                    '–î—É—Ö–æ–≤–∫–∞': 'üçñ',
                    '–°–∫–æ–≤–æ—Ä–æ–¥–∞': 'üç≥',
                    '–ü–∞—Å—Ç–∞ / —Ä–∏—Å': 'üçù',
                    '–•–æ–ª–æ–¥–Ω–æ–µ': 'ü•ó',
                    '–ú–∏–Ω–∏–º—É–º —É—Å–∏–ª–∏–π': '‚ö°'
                };
                const icon = icons[category] || 'üçΩÔ∏è';
                categoryDiv.innerHTML = `<h2>${icon} ${category}</h2>`;

                meals.forEach((meal, index) => {
                    const mealId = `${category}-${index}`;
                    const isSelected = selectedMeals.includes(mealId);
                    
                    const mealDiv = document.createElement('div');
                    mealDiv.className = `meal-item ${isSelected ? 'selected' : ''}`;
                    mealDiv.innerHTML = `
                        <input type="checkbox" id="${mealId}" ${isSelected ? 'checked' : ''}>
                        <div class="meal-info">
                            <div class="meal-name">${meal.name}</div>
                            <div class="meal-ingredients">${meal.ingredients.join(', ')}</div>
                        </div>
                    `;

                    mealDiv.addEventListener('click', (e) => {
                        if (e.target.type !== 'checkbox') {
                            const checkbox = mealDiv.querySelector('input');
                            checkbox.checked = !checkbox.checked;
                            toggleMeal(mealId, checkbox.checked);
                            mealDiv.classList.toggle('selected', checkbox.checked);
                        }
                    });

                    mealDiv.querySelector('input').addEventListener('change', (e) => {
                        toggleMeal(mealId, e.target.checked);
                        mealDiv.classList.toggle('selected', e.target.checked);
                    });

                    categoryDiv.appendChild(mealDiv);
                });

                container.appendChild(categoryDiv);
            }
        }

        function toggleMeal(mealId, isSelected) {
            if (isSelected) {
                if (!selectedMeals.includes(mealId)) {
                    selectedMeals.push(mealId);
                }
            } else {
                selectedMeals = selectedMeals.filter(id => id !== mealId);
            }
            saveSelection();
            updateFloatingBtn();
        }

        function updateFloatingBtn() {
            const btn = document.getElementById('floatingBtn');
            const count = document.getElementById('selectedCount');
            
            if (selectedMeals.length > 0) {
                btn.style.display = 'flex';
                count.textContent = selectedMeals.length;
            } else {
                btn.style.display = 'none';
            }
        }

        function getMealByID(mealId) {
            const [category, index] = mealId.split('-');
            const categoryName = Object.keys(MEALS).find(c => c === category || mealId.startsWith(c));
            if (categoryName && MEALS[categoryName][parseInt(index)]) {
                return MEALS[categoryName][parseInt(index)];
            }
            // Fallback: parse properly
            for (const [cat, meals] of Object.entries(MEALS)) {
                if (mealId.startsWith(cat)) {
                    const idx = parseInt(mealId.replace(cat + '-', ''));
                    if (meals[idx]) return meals[idx];
                }
            }
            return null;
        }

        function generateShoppingList() {
            const ingredientCount = {};
            
            selectedMeals.forEach(mealId => {
                const meal = getMealByID(mealId);
                if (meal) {
                    meal.ingredients.forEach(ingredient => {
                        const normalized = ingredient.toLowerCase().trim();
                        ingredientCount[normalized] = (ingredientCount[normalized] || 0) + 1;
                    });
                }
            });

            return Object.entries(ingredientCount)
                .sort((a, b) => a[0].localeCompare(b[0], 'ru'))
                .map(([ingredient, count]) => ({
                    name: ingredient.charAt(0).toUpperCase() + ingredient.slice(1),
                    count
                }));
        }

        function renderShoppingList() {
            const container = document.getElementById('shoppingList');
            const selectedContainer = document.getElementById('selectedMealsContainer');
            
            // Render selected meals
            if (selectedMeals.length > 0) {
                const mealNames = selectedMeals.map(id => {
                    const meal = getMealByID(id);
                    return meal ? meal.name : '';
                }).filter(Boolean);

                selectedContainer.innerHTML = `
                    <div class="selected-meals">
                        <h3>–í—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞:</h3>
                        <div class="selected-meals-list">
                            ${mealNames.map(name => `<span class="selected-meal-tag">${name}</span>`).join('')}
                        </div>
                    </div>
                `;
            } else {
                selectedContainer.innerHTML = '';
            }

            // Render shopping list
            const items = generateShoppingList();
            
            if (items.length === 0) {
                container.innerHTML = '<div class="empty-state">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª—é–¥–∞, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫</div>';
                return;
            }

            container.innerHTML = items.map(item => {
                const isChecked = checkedItems.includes(item.name);
                return `
                    <li class="${isChecked ? 'checked' : ''}">
                        <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggleItem('${item.name}', this.checked)">
                        <span>${item.name}${item.count > 1 ? ` (√ó${item.count})` : ''}</span>
                    </li>
                `;
            }).join('');
        }

        function toggleItem(name, isChecked) {
            if (isChecked) {
                if (!checkedItems.includes(name)) {
                    checkedItems.push(name);
                }
            } else {
                checkedItems = checkedItems.filter(n => n !== name);
            }
            saveSelection();
            renderShoppingList();
        }

        function showView(view) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            
            if (view === 'meals') {
                document.querySelector('.tab:first-child').classList.add('active');
                document.getElementById('mealsView').classList.add('active');
                document.getElementById('floatingBtn').style.display = selectedMeals.length > 0 ? 'flex' : 'none';
            } else {
                document.querySelector('.tab:last-child').classList.add('active');
                document.getElementById('shoppingView').classList.add('active');
                document.getElementById('floatingBtn').style.display = 'none';
                renderShoppingList();
            }
        }

        function copyList() {
            const items = generateShoppingList();
            const text = items.map(item => 
                `‚Ä¢ ${item.name}${item.count > 1 ? ` (√ó${item.count})` : ''}`
            ).join('\n');
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('–°–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            }).catch(() => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('–°–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            });
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function clearSelection() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞?')) {
                selectedMeals = [];
                checkedItems = [];
                saveSelection();
                renderCategories();
                renderShoppingList();
                updateFloatingBtn();
                showView('meals');
            }
        }

        // Initialize
        renderCategories();
        updateFloatingBtn();
    </script>
</body>
</html>
